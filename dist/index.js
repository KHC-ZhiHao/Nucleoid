"use strict";var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function _asyncToGenerator(t){return function(){var a=t.apply(this,arguments);return new Promise(function(o,s){return function e(t,n){try{var i=a[t](n),r=i.value}catch(t){return void s(t)}if(!i.done)return Promise.resolve(r).then(function(t){e("next",t)},function(t){e("throw",t)});o(r)}("next")})}}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t,e){"undefined"!=typeof module&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e():"function"==typeof define&&(define.amd||define.cmd)?define(function(){return e}):t.Nucleoid=e()}("undefined"!=typeof window?window:global,function(){var o=function(){function e(t){_classCallCheck(this,e),this.$moduleBase={name:t||"no name"}}return _createClass(e,[{key:"$systemError",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"$_no_error";throw"$_no_error"!==n&&(console.log("%c error : ","color:#FFF; background:red"),console.log(n)),new Error("(☉д⊙)!! Nucleoid::"+this.$moduleBase.name+" => "+t+" -> "+e)}},{key:"$noKey",value:function(t,e,n){return null==e[n]||(this.$systemError(t,"Name already exists.",n),!1)}},{key:"$verify",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i={};for(var r in e){var o=e[r];if(o[0]&&null==t[r])return void this.$systemError("verify","Must required",r);t[r]?_typeof(o[1])!==("string"==typeof t[r]&&"#"===t[r][0])||t[r].slice(1)?i[r]=t[r]:this.$systemError("verify","Type("+_typeof(o[1])+") error",r):i[r]=o[1]}return Object.assign(i,n)}},{key:"$protection",value:function(t,e,n,i){var r=this;n[e]=i,Object.defineProperty(t,e,{set:function(){r.$systemError("protection","This key is a private key, can't be change.",e)},get:function(){return n[e]}})}}]),e}(),s=function t(){_classCallCheck(this,t)},a=function(t){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"Root"));return e.gene=t,e.name=t.name,e.base={},e.delay=10,e.operating="undefined"==typeof window?"node":"browser",e.rootStatus=new u(e.name,"root"),e.protection={},e.carryStatus=null,e.pollingEvents=[],e.init(),e}return _inherits(n,o),_createClass(n,[{key:"getBase",value:function(){var t={};for(var e in this.base)t[e]=this.base[e];for(var n in this.protection)t[n]=this.protection[n];return t}},{key:"setTargetStatus",value:function(t){this.carryStatus=t}},{key:"createSystemStatus",value:function(t,e,n){var i=new u(t,"system");i.set(e,n),this.status.addChildren(i)}},{key:"init",value:function(){this.initBase(),this.initPolling()}},{key:"initPolling",value:function(){var i=this;this.interval=setInterval(function(){for(var t=!1,e=0;e<i.pollingEvents.length;e++){var n=i.pollingEvents[e];n.finish?t=!0:n.activate()}t&&i.filterPollingEvents()},this.delay)}},{key:"initBase",value:function(){if(this.gene.genetic){var t=this.gene.genetic();if("object"===(void 0===t?"undefined":_typeof(t)))for(var e in t)this.addBase(e,t[e]);else this.$systemError("initBase","Genetic retrun not a object",t)}}},{key:"addBase",value:function(t,e){null==this.base[t]?"$"===t.slice(0,1)?this.$protection(this.base,t,this.protection,e):this.base[t]=e:this.$systemError("addBase","Base key already exists.",t)}},{key:"polling",value:function(t){this.pollingEvents.push(new e(this,t))}},{key:"clearPollingEvents",value:function(){this.pollingEvents=this.pollingEvents.filter(function(t){return!1===t.finish})}},{key:"createFragment",value:function(t){return new i(this,t).use()}},{key:"close",value:function(t,e){this.rootStatus.set(t,e),clearInterval(this.interval)}},{key:"status",get:function(){return this.carryStatus||this.rootStatus}}]),n}(),e=function(t){function i(t,e){_classCallCheck(this,i);var n=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"PollingEvent"));return n.name=e.name,n.status=new u(n.name,"polling"),n.action=e.action,n.finish=!1,t.status.addChildren(n.status),n}return _inherits(i,o),_createClass(i,[{key:"activate",value:function(){this.action(this.close.bind(this))}},{key:"close",value:function(){this.status.set(!0),this.finish=!0}}]),i}(),i=function(t){function i(t,e){_classCallCheck(this,i);var n=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"Fragment"));return n.over=0,n.name=e||"no name",n.stop=!1,n.status=new u(n.name,"fragment"),n.thread=[],t.status.addChildren(n.status),n}return _inherits(i,o),_createClass(i,[{key:"install",value:function(t){this.callback=t}},{key:"use",value:function(){return{add:this.add.bind(this),activate:this.activate.bind(this)}}},{key:"add",value:function(t){this.thread.push(this.$verify(t,{name:[!0,"#string"],action:[!0,"#function"]}))}},{key:"regsterError",value:function(e){var n=this;return function(t){!1===n.stop&&(e.set(!1,t),n.stop=!0,n.callback(t))}}},{key:"regsterOnload",value:function(t){var e=this;return function(){e.over+=1,!1===e.stop&&e.over>=e.thread.length&&(t.set(!0),e.stop=!0,e.callback())}}},{key:"actionThread",value:function(r){var t,o=this;(t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=new u(r.name,"thread"),n=o.regsterOnload(e),i=o.regsterError(e),o.status.addChildren(e),r.action(i,n);case 5:case"end":return t.stop()}},t,o)})),function(){return t.apply(this,arguments)})()}},{key:"activate",value:function(t){var e=this,n=this.thread.length;this.install(t);for(var i=0;i<n;i++)this.actionThread(this.thread[i]);0===n&&this.callback(null),this.activate=function(){e.$systemError("activate","This template("+e.name+") already  called")}}}]),i}(),n=function(){function e(t){_classCallCheck(this,e),this.name=t.name,this.base=t.base,this.gene=t.gene,this.status=t.rootStatus,this.success=t.rootStatus.success,this.getBase=t.getBase}return _createClass(e,[{key:"isError",value:function(){return!this.success}},{key:"getErrorMessage",value:function(){return this.isError?this.status.message:null}},{key:"getStatusToJson",value:function(){return this.status.json()}},{key:"getMode",value:function(){var t=[];return this.gene.mode.catchException&&t.push("try-catch-mode"),this.gene.mode.timeout&&t.push("timeout"),this.gene.mode.catchUncaughtException&&t.push("uncaught-exception-mode"),this.gene.mode.traceBase&&t.push("trace-base-mode"),t}}]),e}(),u=function(t){function i(t,e){_classCallCheck(this,i);var n=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"Status"));return n.name=t||"no name",n.type=e||"no type",n.message="",n.success=!1,n.children=[],n.startTime=Date.now(),n.attributes={},n.finishTime=null,n}return _inherits(i,o),_createClass(i,[{key:"addAttr",value:function(t,e){this.attributes[t]=e}},{key:"set",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return null==this.finishTime&&(this.success=t,this.message=e,this.finishTime=Date.now()),this}},{key:"get",value:function(){var t={name:this.name,type:this.type,message:this.message,success:this.success,attributes:this.attributes,operationTime:this.operationTime,children:[]},e=!0,n=!1,i=void 0;try{for(var r,o=this.children[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t.children.push(s.get())}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}return t}},{key:"json",value:function(){return JSON.stringify(this.get(),null,4)}},{key:"addChildren",value:function(t){t instanceof i?this.children.push(t):this.$systemError("addChildren","Child not a status class.",t)}},{key:"operationTime",get:function(){return(this.finishTime||Date.now())-this.startTime}}]),i}(),r=function(t){function i(t,e){_classCallCheck(this,i);var n=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"Curry"));return n.group=e,n.data=n.$verify(t,{name:[!0,""],input:[!0,"#function"],output:[!0,"#function"],opener:[!1,[]],methods:[!0,{}]}),n.opener=n.data.opener||null,n.methods={},n.checkPrivateKey(),n}return _inherits(i,o),_createClass(i,[{key:"checkPrivateKey",value:function(){var t=this.data.methods;(t.action||t.promise)&&this.$systemError("init","Methods has private key(action, promise)")}},{key:"use",value:function(){var t=this;return function(){return new c(t,[].concat(Array.prototype.slice.call(arguments))).getRegisterMethod()}}},{key:"name",get:function(){return this.data.name}}]),i}(),c=function(t){function i(t,e){_classCallCheck(this,i);var n=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"CurryUnit"));return n.case=new s,n.flow=[],n.main=t,n.index=0,n.params=e,n.methods={},n.previousFlow=null,n.initRegisterMethod(),n}return _inherits(i,o),_createClass(i,[{key:"initRegisterMethod",value:function(){var e=this,n=this;this.registergMethod={action:this.action.bind(this),promise:this.promise.bind(this)};var t=new l({name:"input",action:this.main.data.input},this.main.group),i=new l({name:"output",action:this.main.data.output},this.main.group);this.input=t.turn(this.case).use(),this.output=i.turn(this.case).use();var r=function(t){e.methods[t]=new l({name:t,action:e.main.data.methods[t]},e.main.group),e.registergMethod[t]=function(){return n.register(t,[].concat(Array.prototype.slice.call(arguments))),n.getRegisterMethod()}};for(var o in this.main.data.methods)r(o)}},{key:"getRegisterMethod",value:function(){return this.registergMethod}},{key:"register",value:function(t,e){0!==this.main.opener.length&&0===this.flow.length&&(this.main.opener.includes(t)||this.$systemError("register","First call method not inside opener.",t));var n={name:t,nextFlow:null,previous:this.flow.slice(-1),index:this.index,method:this.methods[t].turn(this.case).use(),params:e};this.previousFlow&&(this.previousFlow.nextFlow=n),this.previousFlow=n,this.index+=1,this.flow.push(n)}},{key:"include",value:function(t){return this.main.group.getMethod(t).use()}},{key:"action",value:function(e){this.activation(function(t){e(t,null)},function(t){e(null,t)})}},{key:"promise",value:function(){var n=this;return new Promise(function(t,e){n.activation(e,t)})}},{key:"activation",value:function(i,r){var t,o=this,s=!1,a=0;(t=this.input).action.apply(t,_toConsumableArray(this.params).concat([function(t){t?i(t):function e(){var t,n=o.flow[a];n?(t=n.method).action.apply(t,_toConsumableArray(n.params).concat([function(t){t?(i(t),s=!0):(a+=1,!1===s&&e())}])):o.output.action(function(t,e){t?i(t):r(e)})}()}]))}}]),i}(),h=function(t){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"MethodGroup"));return e.case=new s,e.pool={},e.curriedPool={},e.data=e.$verify(t,{create:[!1,function(){}]}),e}return _inherits(n,o),_createClass(n,[{key:"create",value:function(t){this.data.create.bind(this.case)(t),this.create=null}},{key:"getMethod",value:function(t){if(this.pool[t])return this.pool[t];this.$systemError("getMethod","method not found.",t)}},{key:"getCurriedFunction",value:function(t){if(this.curriedPool[t])return this.curriedPool[t];this.$systemError("getCurry","curry not found.",t)}},{key:"currying",value:function(t){var e=new r(t,this);this.$noKey("currying",this.curriedPool,e.name)&&(this.curriedPool[e.name]=e)}},{key:"addMethod",value:function(t){var e=new l(t,this);this.$noKey("addMethod",this.pool,e.name)&&(this.pool[e.name]=e)}},{key:"hasCurry",value:function(t){return!!this.curriedPool[t]}},{key:"hasMethod",value:function(t){return!!this.pool[t]}}]),n}(),l=function(t){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];_classCallCheck(this,i);var n=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"Method"));return n.id=0,n.case=new s,n.used=[],n.store={},n.group=e,n.data=n.$verify(t,{name:[!0,""],create:[!1,function(){}],action:[!0,"#function"],allowDirect:[!1,!0]}),n.argumentLength=n.data.action.length,null==n.group&&n.$systemError("init","No has group",n),n}return _inherits(i,o),_createClass(i,[{key:"turn",value:function(t){return this.case=t,this}},{key:"install",value:function(){this.initBindData(),this.data.create.bind(this.case)(this.bind.create),this.install=null}},{key:"initBindData",value:function(){this.bind={create:{store:this.store,include:this.include.bind(this)},system:{store:this.store,group:this.groupCase,include:this.include.bind(this)},action:this.data.action.bind(this.case)}}},{key:"createLambda",value:function(r,o){var s=this;return function(){var t=[].concat(Array.prototype.slice.call(arguments)),e=null;"action"===o&&("function"==typeof t.slice(-1)[0]?e=t.pop():s.$systemError("createLambda","Action must callback, no need? try direct!"));for(var n=new Array(s.argumentLength-3),i=0;i<n.length;i++)n[i]=t[i];return r.bind(s)(n,e)}}},{key:"include",value:function(t){return this.group.getMethod(t).use()}},{key:"direct",value:function(t){var e;!1===this.data.allowDirect&&this.$systemError("direct","Not allow direct.",this.data.name);var n=null;return(e=this.bind).action.apply(e,_toConsumableArray(t).concat([this.bind.system,function(t){throw new Error(t)},function(t){n=t}])),n}},{key:"action",value:function(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){};(e=this.bind).action.apply(e,_toConsumableArray(t).concat([this.bind.system,function(t){n(t,null)},function(t){n(null,t)}]))}},{key:"promise",value:function(i){var r=this;return new Promise(function(t,e){var n;(n=r.bind).action.apply(n,_toConsumableArray(i).concat([r.bind.system,t,e]))})}},{key:"getStore",value:function(t){if(this.store[t])return this.store[t];this.$systemError("getStore","Key not found.",t)}},{key:"use",value:function(){return this.install&&this.install(),{store:this.getStore.bind(this),direct:this.createLambda(this.direct),action:this.createLambda(this.action,"action"),promise:this.createLambda(this.promise)}}},{key:"name",get:function(){return this.data.name}},{key:"groupCase",get:function(){return this.group.case}}]),i}(),f=function(t){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"Gene"));return e.setName(t||"no name"),e.templates=[],e.genetic=null,e.mode={timeout:null,traceBase:null,catchException:null,catchUncaughtException:null},e.synthesis={initiation:null,elongation:null,termination:null},e}return _inherits(n,o),_createClass(n,[{key:"setName",value:function(t){"string"==typeof t?this.name=t:this.$systemError("setName","Name not a string.",t)}},{key:"setTraceBaseMode",value:function(t,e){"boolean"==typeof t&&"function"==typeof e?t&&(this.mode.traceBase={action:e}):this.$systemError("setTraceBaseMode","Params type error. try setTraceBaseMode(boolean, function)")}},{key:"setTimeoutMode",value:function(t,e,n){"boolean"==typeof t&&"number"==typeof e&&"function"==typeof n?t&&(this.mode.timeout={action:n,millisecond:e}):this.$systemError("setTimeout","Params type error. try setTimeoutMode(boolean, number, function)")}},{key:"setCatchExceptionMode",value:function(t,e){"boolean"==typeof t&&"function"==typeof e?t&&(this.mode.catchException={action:e}):this.$systemError("setCatchExceptionMode","Params type error, try setCatchExceptionMode(boolean, function).")}},{key:"setCatchUncaughtExceptionMode",value:function(t,e){"boolean"==typeof t&&"function"==typeof e?t&&(this.mode.catchUncaughtException={action:e}):this.$systemError("setCatchUncaughtException","Params type error, try setCatchUncaughtException(boolean, function).")}},{key:"setGenetic",value:function(t){"function"==typeof t?this.genetic=t:this.$systemError("setGenetic","Params type error, try setGenetic(callback).")}},{key:"template",value:function(t,e){"string"==typeof t&&"function"==typeof e?this.templates.push({name:t,action:e}):this.$systemError("template","Params type error, try template(string, function).")}},{key:"setInitiation",value:function(t){"function"==typeof t?this.synthesis.initiation=t:this.$systemError("setInitiation","Params type error, try setInitiation(function).")}},{key:"setElongation",value:function(t){"function"==typeof t?this.synthesis.elongation=t:this.$systemError("setElongation","Params type error, try setElongation(function).")}},{key:"setTermination",value:function(t){"function"==typeof t?this.synthesis.termination=t:this.$systemError("setTermination","Params type error, try setTermination(function).")}},{key:"transcription",value:function(){var n=this;return new Promise(function(t,e){new y(n,t,e)})}}]),n}(),d=new(function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"Bioreactor"));return t.groups={},t}return _inherits(e,o),_createClass(e,[{key:"getGroup",value:function(t){return this.groups[t]}},{key:"getMethod",value:function(t,e){return this.getGroup(t).getMethod(e)}},{key:"getCurriedFunction",value:function(t,e){return this.getGroup(t).getCurriedFunction(e)}},{key:"addGroup",value:function(t,e,n){null==this.groups[t]?e instanceof h?(e.create&&e.create(n),this.groups[t]=e):this.$systemError("addGroup","Must group.",e):this.$systemError("addGroup","Name already exists.",t)}},{key:"hasGroup",value:function(t){return!!this.groups[t]}},{key:"hasMethod",value:function(t,e){return!!this.getGroup(t).hasMethod(e)}},{key:"hasCurriedFunction",value:function(t,e){return!!this.getGroup(t).hasCurriedFunction(e)}}]),e}()),y=function(t){function r(t,e,n){_classCallCheck(this,r);var i=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,"Transcription"));return i.gene=t,i.case=new s,i.root=new a(i.gene),i.finish=!1,i.reject=n,i.resolve=e,i.templates=i.gene.templates,i.bioreactor=d,i.init(),i.synthesis(),i}return _inherits(r,o),_createClass(r,[{key:"init",value:function(){this.initBind(),this.initTimeoutMode(),this.initGenerator(),this.initCatchUncaughtExceptionMode()}},{key:"initBind",value:function(){this.bind={io:this.io.bind(this),exit:this.exit.bind(this),fail:this.fail.bind(this),next:this.next.bind(this),cross:this.cross.bind(this),methods:this.methods.bind(this),addBase:this.root.addBase.bind(this.root),polling:this.root.polling.bind(this.root),createFragment:this.root.createFragment.bind(this.root)}}},{key:"initTimeoutMode",value:function(){var e=this;if(this.gene.mode.timeout){var n=this.gene.mode.timeout,t={name:"timeout",action:function(t){e.root.status.operationTime>n.millisecond&&(e.root.createSystemStatus("timeout",!0),n.action.bind(e.case)(e.base,e.bind.exit,e.bind.fail),t())}};this.root.polling(t)}}},{key:"initCatchUncaughtExceptionMode",value:function(){var n=this;this.gene.mode.catchUncaughtException&&(this.uncaughtExceptionAction=function(t){var e=t.stack?t:t.error;n.root.createSystemStatus("uncaught exception",!0,e.message),n.gene.mode.catchUncaughtException.action.bind(n.case)(n.base,e,n.bind.exit,n.bind.fail)},"node"===this.root.operating?(this.uncaughtExceptionDomain=require("domain").create(),this.uncaughtExceptionDomain.on("error",this.uncaughtExceptionAction)):window.addEventListener("error",this.uncaughtExceptionAction))}},{key:"initGenerator",value:function(){var r=this,t=regeneratorRuntime.mark(function t(){var n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=1,i=r.templates[0],r.gene.synthesis.initiation)return r.gene.synthesis.initiation.bind(r.case)(r.base,r.getSkill(),r.bind.next,r.bind.exit,r.bind.fail),void(t.next=6);t.next=6;break;case 6:if(!(n<=1e4)){t.next=16;break}if(r.finish)return t.abrupt("break",16);t.next=11;break;case 11:null==i?r.bind.exit():function(){var t=new u(i.name,"template");r.root.status.addChildren(t),r.root.setTargetStatus(t);var e=function(){e=null,i=r.templates[n++],t.set(!0),r.bind.next(),r.root.setTargetStatus(null)};i.action.bind(r.case)(r.base,r.getSkill(),e,r.bind.exit,r.bind.fail)}();case 12:return void(t.next=14);case 14:t.next=6;break;case 16:return t.abrupt("return");case 17:case"end":return t.stop()}},t,this)});this.iterator=t()}},{key:"deepClone",value:function(e){var r=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new WeakMap;if(Object(e)!==e)return e;if(e instanceof Set)return new Set(e);if(o.has(e))return o.get(e);var s=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):Object.create(null);return o.set(e,s),e instanceof Map&&Array.from(e,function(t){var e=_slicedToArray(t,2),n=e[0],i=e[1];return s.set(n,r.deepClone(i,o))}),Object.assign.apply(Object,[s].concat(_toConsumableArray(Object.keys(e).map(function(t){return _defineProperty({},t,r.deepClone(e[t],o))}))))}},{key:"getSkill",value:function(){return{io:this.bind.io,cross:this.bind.cross,methods:this.bind.methods,polling:this.bind.polling,addBase:this.bind.addBase,createFragment:this.bind.createFragment}}},{key:"methods",value:function(t,e){return this.bioreactor.getMethod(t,e).use()}},{key:"io",value:function(t,e){return this.bioreactor.getCurriedFunction(t,e).use()}},{key:"cross",value:function(t,e){var n=this;t instanceof f?t.transcription().then(function(t){n.root.status.addChildren(t.status),e(null,t)},function(t){n.root.status.addChildren(t.status),e(t.getErrorMessage(),t)}):this.$systemError("cross","Target not a gene module.",t)}},{key:"close",value:function(t,e){this.root.close(t,e),this.gene.mode.catchUncaughtException&&"node"!==this.root.operating&&window.removeEventListener("error",this.uncaughtExceptionAction),this.gene.synthesis.termination&&this.gene.synthesis.termination.bind(this.case)(this.base,this.root.rootStatus)}},{key:"fail",value:function(t){!1===this.finish&&(this.finish=!0,this.close(!1,t),this.reject(new n(this.root)))}},{key:"exit",value:function(t){!1===this.finish&&(this.finish=!0,this.close(!0,t),this.resolve(new n(this.root)))}},{key:"next",value:function(){var t=this;!1===this.finish&&(this.gene.mode.traceBase&&this.gene.mode.traceBase.action(this.deepClone(this.root.getBase()),this.status),this.gene.synthesis.elongation&&this.gene.synthesis.elongation(this.base,this.bind.exit,this.bind.fail),setTimeout(function(){t.synthesis()},1))}},{key:"synthesis",value:function(){this.synthesisTryCatchMode()}},{key:"synthesisTryCatchMode",value:function(){if(this.gene.mode.catchException)try{this.synthesisCatchUncaughtExceptionMode()}catch(t){return this.gene.mode.catchException&&(this.root.createSystemStatus("error catch",!0,t.message),this.gene.mode.catchException.action.bind(this.case)(this.base,t,this.bind.exit,this.bind.fail)),!1}else this.synthesisCatchUncaughtExceptionMode()}},{key:"synthesisCatchUncaughtExceptionMode",value:function(){var t=this;this.gene.mode.catchUncaughtException&&"node"===this.root.operating?this.uncaughtExceptionDomain.run(function(){t.iterator.next()}):this.iterator.next()}},{key:"status",get:function(){return this.root.status}},{key:"base",get:function(){return this.root.base}}]),r}();return function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"addGroup",value:function(t,e,n){d.addGroup(t,e,n)}},{key:"hasCurriedFunction",value:function(t,e){return d.hasCurriedFunction(t,e)}},{key:"hasMethod",value:function(t,e){return d.hasMethod(t,e)}},{key:"hasGroup",value:function(t){return d.hasGroup(groupName,t)}},{key:"callMethod",value:function(t,e){return d.getMethod(t,e).use()}},{key:"callCurriedFunction",value:function(t,e){return d.getCurriedFunction(t,e).use()}},{key:"createMethodGroup",value:function(t){return new h(t)}},{key:"createGene",value:function(t){return new f(t)}}]),t}()});